# 가중최소제곱법(WLS)
---
앞서 살펴본 변수변환 기술과 함께 이분산성 문제를 해결할 수 있는 방법 중 하나가 '가중최소제곱법(WLS)'이다. 
변수변환의 'X term을 이용한 분산 안정화'와 결과적으로는 같은 기술이지만, 이것을 가중치를 부여한다는 관점에서 해석한 것이다.

먼저 가중최소제곱법을 최소제곱법(OLS)와 비교하면 다음과 같다. 

![KakaoTalk_20250509_221636154](https://github.com/user-attachments/assets/0e95cc8e-bdf3-4292-887e-451b2a71b700)

둘다 오차제곱합(MSE)를 최소화하는 계수들을 찾는다는 점은 같지만, WLS는 각 사례(instance)에 가중치를 부여한다.
가중치는 분산의 역수로, 직관적으로 해석하면

## 분산이 크면 그 영향력을 작게 하고(작은 가중치), 분산이 작으면 그만큼 영향력을 키워주는(큰 가중치) 것이다.

이를 다시 써보면

## ∑ W<sub>i</sub> e<sub>i</sub><sup>2</sup>

여기서 오차제곱(e<sub>i</sub><sup>2</sup>)은 실제 y<sub>i</sub> 값이 예측값인 E(y<sub>i</sub>|x<sub>i</sub>)으로부터 얼마나 떨어져 있냐는 것이다.
따라서 이는 오차의 분산에 대한 논의임을 알 수 있다.
가중치(W<sub>i</sub>)는 '분산과의 관계'에서 우리가 결정한 것이기 때문에,
분산(오차제곱)에다가 분산(W<sub>i</sub>)으로 가중치를 주는 것은 단위상 문제가 없어보이고 자연스럽다.

---
## ■ 가중치를 어떻게 정할 것인가?

사실 이는 굉장히 까다로운 문제이다. 기존 이론이나 직관에 의해 오차의 분산(Remind: 지금 등분산성을 만드는 것이 목표이고, 등분산성은 오차의 분산에 대한 것이니까)이 어떤 수식으로 표현됨이 밝혀져 있다면
참 편할텐데, 대부분의 경우 그런 관계는 밝혀져 있지 않다. (그냥 덩그러니 이분산성을 보이는 데이터가 있을 뿐이다.)

따라서 가중치를 주려면, 먼저 오차의 분산을 표현해내는 것이 우선이다. 

이번 포스팅에서는 오차의 분산(Var(&epsilon;<sub>i</sub>)이 기존 배경지식에 의해 미리 밝혀져 있다고(아래 예시에서는 K<sup>2</sup>X<sub>i2</sub>) 가정하고, WLS의 작동방식에 먼저 익숙해지도록 한다.

![KakaoTalk_20250509_223651555](https://github.com/user-attachments/assets/e3925f3e-6f3a-4cdf-8774-f489930825b5)
